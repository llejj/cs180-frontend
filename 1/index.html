<!DOCTYPE html>
<html>
<head>
    <title>Project 1: Colorizing the Prokudin-Gorskii Photo Collection</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 30px;
        }
        
        h1 {
            text-align: center;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
        }
        
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px auto;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .image-comparison {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .image-comparison > div {
            flex: 0 1 48%;
            margin-bottom: 20px;
        }
        
        .image-comparison img {
            width: 100%;
        }
        
        .caption {
            text-align: center;
            font-style: italic;
            margin: 10px 0;
            color: #666;
        }
        
        code {
            background-color: #f8f9fa;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Project 1: Colorizing the Prokudin-Gorskii Photo Collection</h1>
        
        <h2>1. Background</h2>
        <p>
            Sergei Mikhailovich Prokudin-Gorskii (1863-1944) was a pioneering photographer who developed a unique method
            for creating color photographs in the early 1900s. His technique involved capturing three separate exposures
            of each scene through red, green, and blue filters. These images were recorded onto glass plates as a single,
            vertically-stacked black and white negative. Despite the inability to print color photographs at the time,
            he recognized the future potential of his method and documented the Russian Empire in color.
        </p>
        <p>
            This project aims to digitally process and combine these historical glass plate images to reconstruct their
            original color appearance. The challenge lies in properly aligning the three color channels, as misalignments will result in color artifacts and blurring in the final image. We will assume that a simple x,y
            translation model is sufficient for proper alignment.
        </p>

        <h2>2. Single-Scale Image Alignment</h2>
        
        <h3>2.1 Implementation</h3>
        <p>
            The single-scale approach implements a direct pixel-wise alignment method optimized for the smaller JPG images in the collection. This method balances accuracy with computational efficiency through careful choice of alignment metrics and search parameters.
        </p>

        <h4>Key Components:</h4>
        <ul>
            <li><strong>Channel Separation:</strong>
                <ul>
                    <li>Input image is split into three equal vertical sections</li>
                    <li>Each section corresponds to B, G, R color channels from top to bottom</li>
                    <li>Images are normalized to float values in [0,1] range for consistent processing</li>
                </ul>
            </li>
            
            <li><strong>Reference Selection:</strong>
                <ul>
                    <li>Blue channel chosen as the reference frame</li>
                    <li>Green and red channels are aligned to this reference</li>
                </ul>
            </li>
            
            <li><strong>Alignment Metric:</strong>
                <ul>
                    <li>Normalized Cross-Correlation (NCC) used as primary alignment metric</li>
                    <li>NCC is robust to intensity variations between channels</li>
                    <li>Edge cropping (10%) during NCC computation to reduce edge effects by computing alignment metrics only on interior pixels, ignoring border regions</li>
                </ul>
            </li>
            
            <li><strong>Search Strategy:</strong>
                <ul>
                    <li>Comprehensive search within [-15, 15] pixel window for both x and y directions</li>
                    <li>Window size chosen based on typical misalignment observed in the dataset</li>
                    <li>Exhaustive search ensures finding global optimum within search range</li>
                </ul>
            </li>
        </ul>

        <p>
            This implementation is effective for the smaller JPG images (monastery.jpg, cathedral.jpg, tobolsk.jpg). The combination of NCC with edge cropping produces decent results.
        </p>

        <h3>2.2 Results</h3>
        <div class="image-comparison">
            <div>
                <img src="media/data/monastery.jpg" alt="Original monastery image">
                <p class="caption">Original monastery.jpg (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_monastery.jpg" alt="Aligned monastery image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/cathedral.jpg" alt="Original cathedral image">
                <p class="caption">Original cathedral.jpg (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_cathedral.jpg" alt="Aligned cathedral image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/tobolsk.jpg" alt="Original tobolsk image">
                <p class="caption">Original tobolsk.jpg (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_tobolsk.jpg" alt="Aligned tobolsk image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <h2>3. Multi-Scale Pyramid Alignment</h2>
        
        <h3>3.1 Implementation</h3>
        <p>
            To handle the larger TIF images efficiently, a multi-scale pyramid approach was implemented. This method progressively builds a pyramid of images at different resolutions, allowing for a coarse-to-fine alignment strategy that is both computationally efficient and robust.
        </p>

        <h4>Key Components:</h4>
        <ul>
            <li><strong>Pyramid Construction:</strong>
                <ul>
                    <li>Images are recursively downscaled by a factor of 2 using skimage.transform.rescale</li>
                    <li>Downscaling continues until reaching base resolution (128x128 pixels)</li>
                    <li>This creates a pyramid where each level is half the size of the previous</li>
                </ul>
            </li>
            <li><strong>Alignment Process:</strong>
                <ul>
                    <li>Base case: At the coarsest level, performs [-8, 8] pixel search</li>
                    <li>Recursive refinement: Each level scales up previous alignment by 2</li>
                    <li>Local refinement: Searches [-8, 8] window around scaled-up coordinates</li>
                </ul>
            </li>
            <li><strong>Advantages:</strong>
                <ul>
                    <li>Computational efficiency: Majority of searches performed on smaller images</li>
                    <li>Robustness: Coarse alignment helps avoid local minima</li>
                    <li>Precision: Fine-level refinement maintains alignment accuracy</li>
                </ul>
            </li>
        </ul>

        <p>
            The algorithm begins at the coarsest pyramid level where the image is smallest, making the initial alignment computationally efficient. At each subsequent level, the alignment from the previous level is scaled up by a factor of 2 to account for the increase in image size. This scaled alignment serves as an initial guess, around which a smaller [-8, 8] pixel window is searched for refinement. This progressive refinement strategy ensures both efficiency and accuracy.
        </p>

        <h3>3.2 Results</h3>

        <div class="image-comparison">
            <div>
                <img src="media/data/emir.jpg" alt="Original emir image">
                <p class="caption">Original emir.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_emir.jpg" alt="Aligned emir image">
                <p class="caption">Aligned and colorized result. Note that the images to be matched do not actually have the same brightness values (they are different color channels), so NCC is not a good metric to use here. Using edge detection before NCC might address this issue.</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/harvesters.jpg" alt="Original harvesters image">
                <p class="caption">Original harvesters.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_harvesters.jpg" alt="Aligned harvesters image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/icon.jpg" alt="Original icon image">
                <p class="caption">Original icon.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_icon.jpg" alt="Aligned icon image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/italil.jpg" alt="Original italil image">
                <p class="caption">Original italil.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_italil.jpg" alt="Aligned italil image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/lastochikino.jpg" alt="Original lastochikino image">
                <p class="caption">Original lastochikino.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_lastochikino.jpg" alt="Aligned lastochikino image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/lugano.jpg" alt="Original lugano image">
                <p class="caption">Original lugano.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_lugano.jpg" alt="Aligned lugano image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/melons.jpg" alt="Original melons image">
                <p class="caption">Original melons.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_melons.jpg" alt="Aligned melons image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/self_portrait.jpg" alt="Original self portrait image">
                <p class="caption">Original self_portrait.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_self_portrait.jpg" alt="Aligned self portrait image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/siren.jpg" alt="Original siren image">
                <p class="caption">Original siren.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_siren.jpg" alt="Aligned siren image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <div class="image-comparison">
            <div>
                <img src="media/data/three_generations.jpg" alt="Original three generations image">
                <p class="caption">Original three_generations.tif (stacked RGB channels)</p>
            </div>
            <div>
                <img src="media/results/out_three_generations.jpg" alt="Aligned three generations image">
                <p class="caption">Aligned and colorized result</p>
            </div>
        </div>

        <h2>4. Conclusions</h2>
        <p>
            The implemented algorithm successfully colorized the Prokudin-Gorskii photo collection using two different approaches:
        </p>
        <ul>
            <li>
                <strong>Single-Scale Alignment:</strong> Provided excellent results for smaller images (monastery.jpg, cathedral.jpg)
                using direct pixel-wise alignment with NCC metric.
            </li>
            <li>
                <strong>Multi-Scale Pyramid:</strong> Effectively handled larger TIF files through efficient coarse-to-fine
                alignment.
            </li>
        </ul>
        <p>
            The combination of NCC metric with pyramid-based alignment proved computationally efficient and produced good results. It was very cool to align these images that Sergei Mikhailovich Prokudin-Gorskii took over 100 years ago.
        </p>
    </div>
</body>
</html>
